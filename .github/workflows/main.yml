name: esegui-meteo

on:
  workflow_dispatch:     # lo lanciamo a mano oppure via Data Factory

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install requirements (se presenti)
        if: hashFiles('Requirements.txt') != ''
        run: pip install -r Requirements.txt

      - name: Run Meteo.py
        run: python Meteo.py

      # Upload del CSV generato dallo script
      # Assicuriamoci che il tuo file si chiami EstrazioneMeteo.csv
      - name: Upload CSV to Azure Blob via SAS using azcopy
        run: |
          curl -sL https://aka.ms/downloadazcopy-v10-linux | tar -xz --strip-components=1 --wildcards "*/azcopy"
          chmod +x azcopy
          ./azcopy copy "EstrazioneMeteo.csv" "https://${{ secrets.AZ_STORAGE }}.blob.core.windows.net/${{ secrets.AZ_CONTAINER }}/EstrazioneMeteo_$(date +'%Y%m%d').csv${{ secrets.AZ_SAS }}" --overwrite=true
